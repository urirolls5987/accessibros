// Enhanced Accessibility Widget Script

(function () {
    // Initialize the widget
    function initAccessibilityWidget() {
        const widget = createWidgetElement();
        document.body.appendChild(widget);
    
        // Load saved settings
        loadSettings();
    
        // Apply initial styles
        applyStyles();
    }
  
    // Create the widget element
    function createWidgetElement() {
        const widget = document.createElement("div");
        widget.classList.add("asw-widget");
        widget.innerHTML = `
          <button class="asw-menu-btn" aria-label="Toggle Accessibility Menu">
            <span class="material-icons md-36 white">accessibility_new</span>
          </button>
          <div class="asw-menu" style="display: none;">
            <div class="asw-menu-header">
              <div>Accessibility Options</div>
              <div>
                <div role="button" class="asw-menu-reset" title="Reset Settings">
                  <span class="material-icons">restart_alt</span>
                </div>
                <div role="button" class="asw-menu-close" title="Close Accessibility Menu">
                  <span class="material-icons">close</span>
                </div>
              </div>
            </div>

            <!-- Text Adjustments Section -->
            <div class="asw-section">
              <h3>Text Adjustments</h3>
              <div class="asw-slider-group">
                <label for="fontSizeSlider">Text Size</label>
                <button id="decreaseFontSize">-</button>
                <input type="range" id="fontSizeSlider" min="50" max="200" value="100">
                <button id="increaseFontSize">+</button>
              </div>
              <div class="asw-slider-group">
                <label for="lineHeightSlider">Line Height</label>
                <button id="decreaseLineHeight">-</button>
                <input type="range" id="lineHeightSlider" min="1" max="2" step="0.1" value="1.5">
                <button id="increaseLineHeight">+</button>
              </div>
              <div class="asw-slider-group">
                <label for="letterSpacingSlider">Letter Spacing</label>
                <button id="decreaseLetterSpacing">-</button>
                <input type="range" id="letterSpacingSlider" min="0" max="5" step="0.5" value="0">
                <button id="increaseLetterSpacing">+</button>
              </div>
            </div>

            <!-- Visual Adjustments Section -->
            <div class="asw-section">
              <h3>Visual Adjustments</h3>
              <button class="asw-btn" data-action="toggleDyslexicFont">
                <span class="material-icons">spellcheck</span>
                <span class="asw-translate">Dyslexic Font</span>
              </button>
              <button class="asw-btn" data-action="toggleGrayscaleMode">
                <span class="material-icons">photo_filter</span>
                <span class="asw-translate">Grayscale Mode</span>
              </button>
              <button class="asw-btn" data-action="toggleHighContrast">
                <span class="material-icons">contrast</span>
                <span class="asw-translate">High Contrast</span>
              </button>
              <button class="asw-btn" data-action="toggleReadableFont">
                <span class="material-icons">font_download</span>
                <span class="asw-translate">Readable Font</span>
              </button>
            </div>

            <!-- Features Section -->
            <div class="asw-section">
              <h3>Features</h3>
              <button class="asw-btn" data-action="toggleHighlightLinks">
                <span class="material-icons">link</span>
                <span class="asw-translate">Highlight Links</span>
              </button>
              <button class="asw-btn" data-action="toggleBigCursor">
                <span class="material-icons">mouse</span>
                <span class="asw-translate">Big Cursor</span>
              </button>
              <button class="asw-btn" data-action="toggleScreenReader">
                <span class="material-icons">hearing</span>
                <span class="asw-translate">Screen Reader</span>
              </button>
            </div>

            <!-- Company Banner -->
            <div class="asw-banner">
              <a href="https://www.brightwaysaccess.com/" target="_blank">Brightways</a>
            </div>
          </div>
        `;
    
        addEventListeners(widget);
        return widget;
    }
  
    // Add event listeners to widget elements
    function addEventListeners(widget) {
        const toggleBtn = widget.querySelector(".asw-menu-btn");
        const menu = widget.querySelector(".asw-menu");
        const closeBtn = widget.querySelector(".asw-menu-close");
        const resetBtn = widget.querySelector(".asw-menu-reset");
        
        const fontSizeSlider = widget.querySelector("#fontSizeSlider");
        const lineHeightSlider = widget.querySelector("#lineHeightSlider");
        const letterSpacingSlider = widget.querySelector("#letterSpacingSlider");

        // Open/Close menu
        toggleBtn.addEventListener("click", () => {
            menu.style.display = menu.style.display === "none" ? "block" : "none";
        });
        closeBtn.addEventListener("click", () => {
            menu.style.display = "none";
        });

        // Reset settings
        resetBtn.addEventListener("click", resetSettings);

        // Text size slider
        fontSizeSlider.addEventListener("input", () => {
            adjustFontSize(fontSizeSlider.value / 100);
        });

        // Line height slider
        lineHeightSlider.addEventListener("input", () => {
            adjustLineHeight(lineHeightSlider.value);
        });

        // Letter spacing slider
        letterSpacingSlider.addEventListener("input", () => {
            adjustLetterSpacing(letterSpacingSlider.value);
        });
    }

    // Adjust font size
    function adjustFontSize(value) {
        document.documentElement.style.setProperty("--font-size-multiplier", value);
        localStorage.setItem("fontSize", value);
    }

    // Adjust line height
    function adjustLineHeight(value) {
        document.documentElement.style.setProperty("--line-height-multiplier", value);
        localStorage.setItem("lineHeight", value);
    }

    // Adjust letter spacing
    function adjustLetterSpacing(value) {
        document.documentElement.style.setProperty("--letter-spacing", `${value}px`);
        localStorage.setItem("letterSpacing", value);
    }

    // Toggle dyslexic font
    window.toggleDyslexicFont = function () {
        document.body.classList.toggle("dyslexic-font");
        localStorage.setItem("dyslexicFont", document.body.classList.contains("dyslexic-font"));
    };

    // Toggle high contrast
    window.toggleHighContrast = function () {
        document.body.classList.toggle("high-contrast");
        localStorage.setItem("highContrast", document.body.classList.contains("high-contrast"));
    };

    // Toggle grayscale mode
    window.toggleGrayscaleMode = function () {
        document.body.classList.toggle("grayscale-mode");
        localStorage.setItem("grayscaleMode", document.body.classList.contains("grayscale-mode"));
    };

    // Toggle readable font
    window.toggleReadableFont = function () {
        document.body.classList.toggle("readable-font");
        localStorage.setItem("readableFont", document.body.classList.contains("readable-font"));
    };

    // Toggle highlight links
    window.toggleHighlightLinks = function () {
        document.body.classList.toggle("highlight-links");
        localStorage.setItem("highlightLinks", document.body.classList.contains("highlight-links"));
    };

    // Toggle big cursor
    window.toggleBigCursor = function () {
        document.body.classList.toggle("big-cursor");
        localStorage.setItem("bigCursor", document.body.classList.contains("big-cursor"));
    };

    // Screen Reader Toggle
    window.toggleScreenReader = function () {
        const isScreenReaderEnabled = document.body.classList.toggle("screen-reader-enabled");
        localStorage.setItem("screenReaderEnabled", isScreenReaderEnabled);

        if (isScreenReaderEnabled) {
            const utterance = new SpeechSynthesisUtterance(document.body.textContent);
            window.speechSynthesis.speak(utterance);
        } else {
            window.speechSynthesis.cancel();
        }
    };

    // Reset all settings
    function resetSettings() {
        document.documentElement.style.removeProperty("--font-size-multiplier");
        document.documentElement.style.removeProperty("--line-height-multiplier");
        document.documentElement.style.removeProperty("--letter-spacing");
        document.body.classList.remove(
            "dyslexic-font",
            "high-contrast",
            "highlight-links",
            "big-cursor",
            "screen-reader-enabled",
            "grayscale-mode",
            "readable-font"
        );
    
        localStorage.clear();
    
        document.querySelectorAll(".asw-btn").forEach((btn) => btn.classList.remove("asw-selected"));
    }

    // Load settings
    function loadSettings() {
        const fontSize = localStorage.getItem("fontSize");
        if (fontSize) {
            document.documentElement.style.setProperty("--font-size-multiplier", fontSize);
            document.querySelector("#fontSizeSlider").value = fontSize * 100;
        }
    
        const lineHeight = localStorage.getItem("lineHeight");
        if (lineHeight) {
            document.documentElement.style.setProperty("--line-height-multiplier", lineHeight);
            document.querySelector("#lineHeightSlider").value = lineHeight;
        }
    
        const letterSpacing = localStorage.getItem("letterSpacing");
        if (letterSpacing) {
            document.documentElement.style.setProperty("--letter-spacing", `${letterSpacing}px`);
            document.querySelector("#letterSpacingSlider").value = letterSpacing;
        }
    
        if (localStorage.getItem("dyslexicFont") === "true")
            document.body.classList.add("dyslexic-font");
        if (localStorage.getItem("highContrast") === "true")
            document.body.classList.add("high-contrast");
        if (localStorage.getItem("highlightLinks") === "true")
            document.body.classList.add("highlight-links");
        if (localStorage.getItem("bigCursor") === "true")
            document.body.classList.add("big-cursor");
        if (localStorage.getItem("screenReaderEnabled") === "true")
            document.body.classList.add("screen-reader-enabled");
        if (localStorage.getItem("grayscaleMode") === "true")
            document.body.classList.add("grayscale-mode");
        if (localStorage.getItem("readableFont") === "true")
            document.body.classList.add("readable-font");

        document.querySelectorAll(".asw-btn").forEach((btn) => {
            const action = btn.dataset.action;
            if (localStorage.getItem(action) === "true") {
                btn.classList.add("asw-selected");
            }
        });
    }
  
    // Apply styles
    function applyStyles() {
        const style = document.createElement("style");
        style.textContent = `
            @import url("https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;500;600;700&display=swap");
            @import url("https://fonts.googleapis.com/icon?family=Material+Icons");
        
            :root {
                --font-size-multiplier: 1;
                --line-height-multiplier: 1;
                --letter-spacing: 0px;
                --text-contrast: 1;
            }
        
            body {
                font-size: calc(1rem * var(--font-size-multiplier));
                line-height: calc(1.5 * var(--line-height-multiplier));
                letter-spacing: var(--letter-spacing);
            }
        
            .asw-menu {
                font-family: "Inter", sans-serif;
                position: fixed;
                right: 20px;
                top: 20px;
                border-radius: 8px;
                box-shadow: 0px 0px 20px #00000080;
                opacity: 1;
                transition: 0.3s;
                z-index: 500000;
                overflow: hidden;
                background: #f9f9f9;
                width: 300px;
                line-height: 1;
                font-size: 16px;
                letter-spacing: 0.015em;
                height: auto;
                color: #000;
            }

            .asw-menu-content {
                max-height: 400px;
                overflow-y: auto;
                padding: 15px 0;
                color: #333;
            }

            .asw-section {
                background: #eaeaea;
                border-radius: 10px;
                margin: 15px;
                padding: 10px;
                box-shadow: 0px 3px 10px rgba(0, 0, 0, 0.1);
            }

            .asw-section h3 {
                margin: 0 0 10px 0;
                font-size: 18px;
                color: #419d4a;
            }

            .asw-slider-group {
                display: flex;
                align-items: center;
                justify-content: space-between;
                margin-bottom: 10px;
            }

            .asw-slider-group input {
                flex-grow: 1;
                margin: 0 10px;
            }

            .asw-slider-group button {
                background: #fff;
                border: 1px solid #dedede;
                padding: 5px;
                cursor: pointer;
                border-radius: 5px;
            }
        
            .asw-btn {
                aspect-ratio: 6 / 5;
                border-radius: 4px;
                padding: 0 15px;
                display: flex;
                align-items: center;
                justify-content: center;
                flex-direction: column;
                text-align: center;
                color: #333;
                font-size: 16px !important;
                background: #fff;
                border: 1px solid #dedede;
                transition: all 0.3s ease;
                cursor: pointer;
                line-height: 1.4;
            }

            .asw-btn:hover {
                border-color: #419d4a;
            }

            .asw-btn.asw-selected {
                background: #419d4a;
                color: white;
                border-color: #419d4a;
            }
        
            .asw-menu-btn {
                position: fixed;
                z-index: 500000;
                right: 20px;
                bottom: 20px;
                background: #419d4a;
                box-shadow: 0 5px 15px 0 rgb(37 44 97 / 15%), 0 2px 4px 0 rgb(93 100 148 / 20%);
                transition: 0.3s;
                border-radius: 50%;
                align-items: center;
                justify-content: center;
                transform: scale(1);
                width: 54px;
                height: 54px;
                display: flex;
                cursor: pointer;
                border: 4px solid white;
                outline: 4px solid #419d4a;
                text-decoration: none;
            }

            .asw-menu-btn:hover {
                transform: scale(1.1);
            }

            .material-icons.md-36.white {
                font-size: 36px;
                color: #f9f9f9;
            }

            @font-face {
                font-family: "OpenDyslexic3";
                src: url("https://website-widgets.pages.dev/fonts/OpenDyslexic3-Regular.woff") format("woff"),
                     url("https://website-widgets.pages.dev/fonts/OpenDyslexic3-Regular.ttf") format("truetype");
            }

            body.dyslexic-font {
                font-family: "OpenDyslexic3", sans-serif;
            }

            body.high-contrast {
                background-color: #000;
                color: #fff;
            }

            body.grayscale-mode {
                filter: grayscale(100%);
            }

            body.highlight-links a {
                background-color: yellow;
                color: #000;
            }

            body.big-cursor,
            body.big-cursor * {
                cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64' viewBox='0 0 24 24'%3E%3Cpath d='M7,2l12,11.2l-5.8,0.5l3.3,7.3l-2.2,1l-3.2-7.4L7,18.5V2' fill='%23000000' stroke='%23ffffff' stroke-width='1'/%3E%3C/svg%3E"), auto;
            }

            .asw-banner {
                background-color: #419d4a;
                color: white;
                text-align: center;
                padding: 10px;
                border-radius: 0 0 10px 10px;
            }

            .asw-banner a {
                color: white;
                text-decoration: none;
            }
        
            @media only screen and (max-width: 560px) {
                .asw-menu {
                    width: calc(100% - 20px);
                    left: 10px;
                    right: 10px;
                }
            }
        
            @media only screen and (max-width: 420px) {
                .asw-items {
                    grid-template-columns: repeat(2, minmax(0, 1fr));
                    gap: 0.5rem;
                }
            }
        `;
        document.head.appendChild(style);
    }
    // Initialize the widget when the DOM is fully loaded
    if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", initAccessibilityWidget);
    } else {
        initAccessibilityWidget();
    }
})();
