// Enhanced Accessibility Widget Script

(function () {
    // Initialize the widget
    function initAccessibilityWidget() {
      const widget = createWidgetElement();
      document.body.appendChild(widget);
  
      // Load saved settings
      loadSettings();
  
      // Apply initial styles
      applyStyles();
    }
  
    // Create the widget element
    function createWidgetElement() {
      const widget = document.createElement("div");
      widget.classList.add("asw-widget");
      widget.innerHTML = `
          <button class="asw-menu-btn" aria-label="Toggle Accessibility Menu">
            <span class="material-icons md-36 white">accessibility_new</span>
          </button>
          <div class="asw-menu" style="display: none;">
            <div class="asw-menu-header">
              <div>Accessibility Options</div>
              <div>
                <div role="button" class="asw-menu-reset" title="Reset Settings">
                  <span class="material-icons">restart_alt</span>
                </div>
                <div role="button" class="asw-menu-close" title="Close Accessibility Menu">
                  <span class="material-icons">close</span>
                </div>
              </div>
            </div>
            <div class="asw-menu-content">
              <div class="asw-card">
                <div class="asw-items">
                  <button class="asw-btn" data-action="increaseFontSize">
                    <span class="material-icons">format_size</span>
                    <span class="asw-translate">Increase Font Size</span>
                  </button>
                  <button class="asw-btn" data-action="decreaseFontSize">
                    <span class="material-icons">text_fields</span>
                    <span class="asw-translate">Decrease Font Size</span>
                  </button>
                  <button class="asw-btn" data-action="increaseLineHeight">
                    <span class="material-icons">format_line_spacing</span>
                    <span class="asw-translate">Increase Line Height</span>
                  </button>
                  <button class="asw-btn" data-action="increaseLetterSpacing">
                    <span class="material-icons">text_rotation_none</span>
                    <span class="asw-translate">Increase Letter Spacing</span>
                  </button>
                  <button class="asw-btn" data-action="toggleDyslexicFont">
                    <span class="material-icons">spellcheck</span>
                    <span class="asw-translate">Dyslexic Font</span>
                  </button>
                  <button class="asw-btn" data-action="toggleHighContrast">
                    <span class="material-icons">contrast</span>
                    <span class="asw-translate">High Contrast</span>
                  </button>
                  <button class="asw-btn" data-action="toggleHighlightLinks">
                    <span class="material-icons">link</span>
                    <span class="asw-translate">Highlight Links</span>
                  </button>
                  <button class="asw-btn" data-action="toggleBigCursor">
                    <span class="material-icons">mouse</span>
                    <span class="asw-translate">Big Cursor</span>
                  </button>
                  <button class="asw-btn" data-action="toggleScreenReader">
                    <span class="material-icons">hearing</span>
                    <span class="asw-translate">Screen Reader</span>
                  </button>
                  <button class="asw-btn" data-action="toggleDarkMode">
                    <span class="material-icons">dark_mode</span>
                    <span class="asw-translate">Dark Mode</span>
                  </button>
                  <button class="asw-btn" data-action="togglePauseAnimations">
                    <span class="material-icons">pause_circle</span>
                    <span class="asw-translate">Pause Animations</span>
                  </button>
                  <button class="asw-btn" data-action="increaseTextContrast">
                    <span class="material-icons">brightness_6</span>
                    <span class="asw-translate">Increase Text Contrast</span>
                  </button>
                  <button class="asw-btn" data-action="decreaseTextContrast">
                    <span class="material-icons">brightness_low</span>
                    <span class="asw-translate">Decrease Text Contrast</span>
                  </button>
                  <button class="asw-btn" data-action="toggleGrayscaleMode">
                    <span class="material-icons">photo_filter</span>
                    <span class="asw-translate">Grayscale Mode</span>
                  </button>
                  <button class="asw-btn" data-action="toggleUnderlineLinks">
                    <span class="material-icons">format_underlined</span>
                    <span class="asw-translate">Underline Links</span>
                  </button>
                  <button class="asw-btn" data-action="toggleReadableFont">
                    <span class="material-icons">font_download</span>
                    <span class="asw-translate">Readable Font</span>
                  </button>
                  <button class="asw-btn" data-action="toggleCursorMagnification">
                    <span class="material-icons">zoom_in</span>
                    <span class="asw-translate">Magnify Cursor Area</span>
                  </button>
                  <button class="asw-btn" data-action="toggleTooltipEnlargement">
                    <span class="material-icons">announcement</span>
                    <span class="asw-translate">Enlarge Tooltips</span>
                  </button>
                </div>
              </div>
            </div>
          </div>
        `;
  
      addEventListeners(widget);
      return widget;
    }
  
    // Add event listeners to widget elements
    function addEventListeners(widget) {
      const toggleBtn = widget.querySelector(".asw-menu-btn");
      const menu = widget.querySelector(".asw-menu");
      const closeBtn = widget.querySelector(".asw-menu-close");
      const resetBtn = widget.querySelector(".asw-menu-reset");
      const actionBtns = widget.querySelectorAll(".asw-btn");
  
      toggleBtn.addEventListener("click", () => {
        menu.style.display = menu.style.display === "none" ? "block" : "none";
      });
  
      closeBtn.addEventListener("click", () => {
        menu.style.display = "none";
      });
  
      resetBtn.addEventListener("click", resetSettings);
  
      actionBtns.forEach((btn) => {
        btn.addEventListener("click", () => {
          const action = btn.dataset.action;
          if (typeof window[action] === "function") {
            window[action]();
            btn.classList.toggle("asw-selected");
            saveSettings();
          }
        });
      });
    }

    // Accessibility Features

    // Screen Reader Toggle
    window.toggleScreenReader = function () {
      const isScreenReaderEnabled = document.body.classList.toggle("screen-reader-enabled");
      localStorage.setItem("screenReaderEnabled", isScreenReaderEnabled);
  
      if (isScreenReaderEnabled) {
          const utterance = new SpeechSynthesisUtterance(document.body.textContent);
          window.speechSynthesis.speak(utterance);
      } else {
          window.speechSynthesis.cancel();
      }
    };
    
    // Dark Mode Toggle
    window.toggleDarkMode = function () {
      const isDarkModeEnabled = document.body.classList.toggle("dark-mode");
      localStorage.setItem("darkMode", isDarkModeEnabled);
    };
    
    // Pause Animations
    window.togglePauseAnimations = function () {
      const areAnimationsPaused = document.body.classList.toggle("pause-animations");
      localStorage.setItem("pauseAnimations", areAnimationsPaused);
    };
    
    // Text Contrast Adjuster
    window.increaseTextContrast = function () {
      adjustContrast(0.1);
    };
  
    window.decreaseTextContrast = function () {
      adjustContrast(-0.1);
    };
  
    function adjustContrast(delta) {
      const currentContrast = parseFloat(localStorage.getItem("textContrast") || 1);
      const newContrast = Math.max(1, Math.min(2, currentContrast + delta));
      document.documentElement.style.setProperty("--text-contrast", newContrast);
      localStorage.setItem("textContrast", newContrast);
    }
    
    // Grayscale Mode Toggle
    window.toggleGrayscaleMode = function () {
      const isGrayscaleEnabled = document.body.classList.toggle("grayscale-mode");
      localStorage.setItem("grayscaleMode", isGrayscaleEnabled);
    };
    
    // Underline Links
    window.toggleUnderlineLinks = function () {
      const isUnderlineEnabled = document.body.classList.toggle("underline-links");
      localStorage.setItem("underlineLinks", isUnderlineEnabled);
    };
    
    // Toggle Readable Font
    window.toggleReadableFont = function () {
      document.body.classList.toggle("readable-font");
      localStorage.setItem("readableFont", document.body.classList.contains("readable-font"));
    };
    
    // Cursor Magnification
    window.toggleCursorMagnification = function () {
      document.body.classList.toggle("magnified-cursor");
      localStorage.setItem("magnifiedCursor", document.body.classList.contains("magnified-cursor"));
    };
    
    // Tooltip Enlargement
    window.toggleTooltipEnlargement = function () {
      document.body.classList.toggle("enlarged-tooltips");
      localStorage.setItem("enlargedTooltips", document.body.classList.contains("enlarged-tooltips"));
    };
    
    // Save settings
    function saveSettings() {
      // Settings are saved in individual functions
    }

    // Reset all settings
    function resetSettings() {
      document.documentElement.style.removeProperty("--font-size-multiplier");
      document.documentElement.style.removeProperty("--line-height-multiplier");
      document.documentElement.style.removeProperty("--letter-spacing");
      document.body.classList.remove(
        "dyslexic-font",
        "high-contrast",
        "highlight-links",
        "big-cursor",
        "dark-mode",
        "screen-reader-enabled",
        "pause-animations",
        "grayscale-mode",
        "underline-links",
        "readable-font",
        "magnified-cursor",
        "enlarged-tooltips"
      );
  
      localStorage.clear();
  
      document.querySelectorAll(".asw-btn").forEach((btn) => btn.classList.remove("asw-selected"));
    }
    
    // Load settings
    function loadSettings() {
      const settings = [
        "fontSize", "lineHeight", "letterSpacing", "dyslexicFont",
        "highContrast", "highlightLinks", "bigCursor", "darkMode",
        "screenReaderEnabled", "pauseAnimations", "textContrast",
        "grayscaleMode", "underlineLinks", "readableFont",
        "magnifiedCursor", "enlargedTooltips"
      ];
      
      settings.forEach(setting => {
        if (localStorage.getItem(setting) === "true") {
          document.body.classList.add(setting);
        }
      });
      
      const fontSize = localStorage.getItem("fontSize");
      if (fontSize) document.documentElement.style.setProperty("--font-size-multiplier", fontSize);
      
      const lineHeight = localStorage.getItem("lineHeight");
      if (lineHeight) document.documentElement.style.setProperty("--line-height-multiplier", lineHeight);
      
      const letterSpacing = localStorage.getItem("letterSpacing");
      if (letterSpacing) document.documentElement.style.setProperty("--letter-spacing", `${letterSpacing}px`);
      
      const textContrast = localStorage.getItem("textContrast");
      if (textContrast) document.documentElement.style.setProperty("--text-contrast", textContrast);
      
      document.querySelectorAll(".asw-btn").forEach(btn => {
        const action = btn.dataset.action;
        if (localStorage.getItem(action) === "true") {
          btn.classList.add("asw-selected");
        }
      });
    }

    // Apply styles
    function applyStyles() {
      const style = document.createElement("style");
      style.textContent = `
          @import url("https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;500;600;700&display=swap");
          @import url("https://fonts.googleapis.com/icon?family=Material+Icons");
    
          :root {
            --font-size-multiplier: 1;
            --line-height-multiplier: 1;
            --letter-spacing: 0px;
            --text-contrast: 1;
          }
    
          body {
            font-size: calc(1rem * var(--font-size-multiplier));
            line-height: calc(1.5 * var(--line-height-multiplier));
            letter-spacing: var(--letter-spacing);
            filter: contrast(var(--text-contrast));
          }
    
          .asw-menu {
            font-family: "Inter", sans-serif;
            position: fixed;
            right: 20px;
            top: 20px;
            border-radius: 8px;
            box-shadow: 0px 0px 20px #00000080;
            opacity: 1;
            transition: 0.3s;
            z-index: 500000;
            overflow: hidden;
            background: #f9f9f9;
            width: 500px;
            line-height: 1;
            font-size: 16px;
            letter-spacing: 0.015em;
            height: calc(100% - 40px - 75px);
            color: #000;
          }

          body.dark-mode {
            background-color: #121212;
            color: #e0e0e0;
          }

          body.dark-mode a {
            color: #bb86fc;
          }

          body.pause-animations * {
            animation: none !important;
            transition: none !important;
          }
  
          body.grayscale-mode {
            filter: grayscale(100%);
          }

          body.underline-links a {
            text-decoration: underline;
          }

          body.readable-font {
            font-family: "Arial", sans-serif;
            font-size: 1.2rem;
            line-height: 1.8;
          }

          body.magnified-cursor * {
            cursor: zoom-in !important;
          }

          body.enlarged-tooltips [title]:hover::after {
            content: attr(title);
            position: absolute;
            background: #000;
            color: #fff;
            padding: 10px;
            font-size: 1.5rem;
            z-index: 1000;
          }
    
          .asw-menu-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-left: 18px;
            height: 60px;
            font-size: 18px;
            font-weight: 700;
            border-bottom: 1px solid #dedede;
            color: #000;
          }
    
          .asw-menu-header > div {
            display: flex;
          }
    
          .asw-menu-header div[role="button"] {
            padding: 12px;
            cursor: pointer;
            color: #000;
          }
    
          .asw-menu-header div[role="button"]:hover {
            opacity: 0.8;
          }
    
          .asw-card {
            margin: 0 15px 30px;
          }
    
          .asw-items {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 1rem;
          }
    
          .asw-btn {
            aspect-ratio: 6 / 5;
            border-radius: 4px;
            padding: 0 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            text-align: center;
            color: #333;
            font-size: 16px !important;
            background: #fff;
            border: 1px solid #dedede;
            transition: all 0.3s ease;
            cursor: pointer;
            line-height: 1.4;
          }
    
          .asw-btn .asw-translate {
            font-size: 15px !important;
          }
    
          .asw-btn .material-icons {
            margin-bottom: 16px;
          }
    
          .asw-btn:hover {
            border-color: #419d4a;
          }
    
          .asw-btn.asw-selected {
            background: #419d4a;
            color: white;
            border-color: #419d4a;
          }
    
          .asw-menu-content {
            overflow-y: scroll;
            max-height: calc(100% - 80px);
            color: #333;
            padding: 15px 0;
          }
    
          .asw-menu-btn {
            position: fixed;
            z-index: 500000;
            right: 20px;
            bottom: 20px;
            background: #419d4a;
            box-shadow: 0 5px 15px 0 rgb(37 44 97 / 15%), 0 2px 4px 0 rgb(93 100 148 / 20%);
            transition: 0.3s;
            border-radius: 50%;
            align-items: center;
            justify-content: center;
            transform: scale(1);
            width: 54px;
            height: 54px;
            display: flex;
            cursor: pointer;
            border: 4px solid white;
            outline: 4px solid #419d4a;
            text-decoration: none;
          }
    
          .asw-menu-btn:hover {
            transform: scale(1.1);
          }
    
          .material-icons.md-36.white {
            font-size: 36px;
            color: #f9f9f9;
          }
    
          @font-face {
            font-family: "OpenDyslexic3";
            src: url("https://website-widgets.pages.dev/fonts/OpenDyslexic3-Regular.woff") format("woff"),
                 url("https://website-widgets.pages.dev/fonts/OpenDyslexic3-Regular.ttf") format("truetype");
          }
    
          body.dyslexic-font {
            font-family: "OpenDyslexic3", sans-serif;
          }
    
          body.high-contrast {
            background-color: #000;
            color: #fff;
          }
    
          body.highlight-links a {
            background-color: yellow;
            color: #000;
          }
    
          body.big-cursor,
          body.big-cursor * {
              cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64' viewBox='0 0 24 24'%3E%3Cpath d='M7,2l12,11.2l-5.8,0.5l3.3,7.3l-2.2,1l-3.2-7.4L7,18.5V2' fill='%23000000' stroke='%23ffffff' stroke-width='1'/%3E%3C/svg%3E"), auto;
          }
  
        @media only screen and (max-width: 560px) {
          .asw-menu-btn {
            width: 38px;
            height: 38px;
          }
          .asw-menu-btn .material-icons {
            font-size: 24px;
          }
          .asw-menu {
            width: calc(100% - 20px);
            left: 10px;
            right: 10px;
          }
        }
  
        @media only screen and (max-width: 420px) {
          .asw-items {
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 0.5rem;
          }
        }
      `;
      document.head.appendChild(style);
    }
  
    // Initialize the widget when the DOM is fully loaded
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", initAccessibilityWidget);
    } else {
      initAccessibilityWidget();
    }
  })();
